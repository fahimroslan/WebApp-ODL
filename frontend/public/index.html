<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ODL Transcript Workspace</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/main.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" defer></script>
    <script type="module" src="../src/main.js" defer></script>
</head>
<body>
    <div class="shell">
        <header>
            <div class="eyebrow">Open & Distance Learning</div>
            <h1>ODL Transcript Workspace</h1>
            <p>Upload transcript data once, let students and staff retrieve polished slips anytime.</p>
        </header>
        <div class="tabs">
            <button class="tab-button active" data-tab="student-tab">Student Access</button>
            <button class="tab-button" data-tab="admin-tab">Admin Console</button>
        </div>
        <section id="student-tab" class="tab-content active">
            <div class="stack">
                <div class="card">
                    <h2>Check your transcript</h2>
                    <p class="muted">Enter IC and the name that appears on your identification card.</p>
                    <form id="studentLoginForm" class="stack" style="margin-top:16px;">
                        <div>
                            <label for="studentIcInput">IC Number</label>
                            <input type="text" id="studentIcInput" placeholder="900906-14-XXXX" required>
                        </div>
                        <div>
                            <label for="studentNameInput">Full Name</label>
                            <input type="text" id="studentNameInput" placeholder="As shown on IC" required>
                        </div>
                        <button type="submit" class="primary-btn">Retrieve transcript</button>
                        <p id="student-login-error" class="hidden status error"></p>
                        <p class="muted">Build ID: <span id="login-app-id">--</span></p>
                    </form>
                </div>
                <div id="studentResultCard" class="card hidden">
                    <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
                        <div>
                            <h3>Official transcript</h3>
                            <p class="muted">Print-ready view</p>
                        </div>
                        <div style="display:flex; gap:8px;">
                            <button type="button" id="clearStudentView" class="secondary-btn">Clear</button>
                            <button type="button" id="printStudentSlip" class="primary-btn">Print</button>
                        </div>
                    </div>
                    <div id="student-slip-output" style="margin-top:16px;"></div>
                </div>
            </div>
        </section>
        <section id="admin-tab" class="tab-content">
            <div class="stack">
                <div id="admin-login-card" class="card">
                    <h2>Staff access</h2>
                    <p class="muted">Enter the shared access code to open the console.</p>
                    <form id="adminAccessForm" class="stack" style="margin-top:16px; max-width:320px;">
                        <div>
                            <label for="adminCodeInput">Access code</label>
                            <input type="password" id="adminCodeInput" placeholder="Enter code" required>
                        </div>
                        <button type="submit" class="primary-btn">Unlock console</button>
                        <p id="admin-inline-error" class="hidden status error"></p>
                    </form>
                    <p class="muted" style="margin-top:12px;">Default code lives inside <code>config.js</code>. Change it before deploying.</p>
                </div>
                <div id="admin-workspace" class="hidden stack">
                    <div class="card">
                        <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;">
                            <div>
                                <p class="eyebrow">Administrator</p>
                                <h3 id="adminWelcomeEmail">Admin User</h3>
                                <p class="muted">Manage sessions, imports, and transcripts.</p>
                            </div>
                            <button id="adminLogoutBtn" class="secondary-btn">Sign out</button>
                        </div>
                        <div class="stat-board" style="margin-top:16px;">
                            <div class="stat">
                                <span>Course catalog</span>
                                <strong id="catalogStat">0</strong>
                            </div>
                            <div class="stat">
                                <span>Student records</span>
                                <strong id="studentStat">0</strong>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="sub-tabs">
                            <button class="sub-tab active" data-section="admin-session">Session Setting</button>
                            <button class="sub-tab" data-section="admin-upload">Upload History & Append Marks</button>
                            <button class="sub-tab" data-section="admin-directory">Student Directory</button>
                        </div>
                        <div id="admin-session" class="sub-section active">
                            <h3>Session setting</h3>
                            <p class="muted">Update the academic session reference and quickly review stats.</p>
                            <div style="display:flex; gap:12px; margin-top:12px; align-items:flex-start; flex-wrap:wrap;">
                                <div style="flex:1; min-width:220px;">
                                    <label for="setSessionInput">Active session</label>
                                    <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
                                        <input type="text" id="setSessionInput" placeholder="e.g., 2025-09" style="flex:1; min-width:220px;">
                                        <button id="saveSessionBtn" class="primary-btn" style="white-space:nowrap;">Save Session</button>
                                    </div>
                                </div>
                            </div>
                            <div id="admin-status" class="hidden status info" style="margin-top:16px;">
                                <span id="admin-status-icon">i</span>
                                <p id="admin-status-text">Status</p>
                            </div>
                        </div>
                        <div id="admin-upload" class="sub-section">
                            <h3>Upload history & append marks</h3>
                            <p class="muted">Follow the instructions below to ensure every import aligns with the required schema.</p>
                            <div class="grid-two" style="margin-top:16px;">
                                <div>
                                    <h4>Initialize / Reset history</h4>
                                    <div class="muted" style="font-size:0.9rem;">
                                        <p style="margin-bottom:8px;">Use <strong>marks_with_semesters_2.xlsx</strong> &mdash; sheet <strong>Joined</strong>.</p>
                                        <p style="margin-bottom:6px;">Required columns:</p>
                                        <ul style="margin:0 0 8px 18px; padding:0; list-style:disc;">
                                            <li>ID, Name, IC, Intake</li>
                                            <li>CourseCode, Course Title, Credits</li>
                                            <li>Semester, SessionLabel (optional)</li>
                                            <li>Mark or Letter, GradePoints (optional)</li>
                                        </ul>
                                        <p style="margin-bottom:0;">Only include finalised grades. Duplicate IDs overwrite previous history.</p>
                                    </div>
                                    <div class="file-input" style="margin-top:12px; align-items:flex-start;">
                                        <input type="file" id="historyFile" accept=".xlsx,.csv" style="width:100%;">
                                        <button id="processHistoryBtn" class="primary-btn" style="align-self:flex-start;">Import history</button>
                                    </div>
                                </div>
                                <div>
                                    <h4>Append marks</h4>
                                    <div class="muted" style="font-size:0.9rem;">
                                        <p style="margin-bottom:8px;">Use a simple CSV/XLSX with these required columns (for both existing and new students):</p>
                                        <ul style="margin:0 0 8px 18px; padding:0; list-style:disc;">
                                            <li>ID (matric number)</li>
                                            <li>Name</li>
                                            <li>IC</li>
                                            <li>Intake</li>
                                            <li>CourseCode (must match catalog)</li>
                                            <li>Mark (numeric) or Letter</li>
                                        </ul>
                                        <p style="margin:0 0 4px 0;">Optional columns: Title, Credits override, SessionLabel (overrides active session).</p>
                                        <p style="margin-bottom:0;">Rows missing any required field are skipped. Keep the schema uniform for every row so future students can be created automatically.</p>
                                    </div>
                                    <div class="file-input" style="margin-top:12px; align-items:flex-start;">
                                        <input type="file" id="appendFile" accept=".xlsx,.csv" style="width:100%;">
                                        <button id="appendMarksBtn" class="primary-btn" style="align-self:flex-start;">Append marks</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="admin-directory" class="sub-section">
                            <div id="admin-directory-card">
                                <div style="display:flex; justify-content:space-between; gap:12px; align-items:center; flex-wrap:wrap;">
                                    <div>
                                        <h3>Student directory</h3>
                                        <p class="muted">Search by matric ID or name</p>
                                    </div>
                                    <div style="display:flex; gap:8px; flex-wrap:wrap;">
                                        <select id="intakeFilter" style="padding:10px 12px; border-radius:10px; border:1px solid #cbd5f5;">
                                            <option value="">All intakes</option>
                                        </select>
                                        <input type="search" id="studentSearch" placeholder="Search..." style="max-width:240px;">
                                    </div>
                                </div>
                                <div class="table-wrapper" style="margin-top:12px;">
                                    <table>
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Intake</th>
                                            <th style="text-align:right;">CGPA</th>
                                            <th style="text-align:right;">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="studentList">
                                        <tr><td colspan="5" style="text-align:center; padding:16px;">No data</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="pagination">
                                <button id="prevPage">Prev</button>
                                <p id="paginationText">No data</p>
                                <button id="nextPage">Next</button>
                            </div>
                        </div>
                        <div id="admin-detail-card" class="hidden">
                            <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;">
                                <div>
                                    <h3 id="detailStudentName">Student overview</h3>
                                    <p class="muted" id="detailStudentId">Select a student to display details</p>
                                </div>
                                <div style="display:flex; gap:8px;">
                                    <button type="button" id="backToDirectoryBtn" class="secondary-btn">Back to directory</button>
                                    <button type="button" id="printAdminSlip" class="primary-btn">Print</button>
                                </div>
                            </div>
                            <div class="detail-tabs" style="margin-top:16px;">
                                <button type="button" class="detail-tab active" data-detail="overview">Student detail</button>
                                <button type="button" class="detail-tab" data-detail="transcript">Transcript</button>
                            </div>
                            <div id="detail-overview" class="detail-panel active">
                                <div id="admin-summary-output" style="margin-top:16px;"></div>
                            </div>
                            <div id="detail-transcript" class="detail-panel">
                                <div id="admin-slip-output" style="margin-top:16px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <div id="printable-slip"></div>
</body>
</html>
